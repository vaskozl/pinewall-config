#!/bin/sh
sed -i '/^alpine-base$/d' /etc/apk/world
mkdir -p /.modloop
mount /media/*/boot/modloop-* -o loop,ro /.modloop
ln -s /.modloop/modules /lib/modules
depmod
modprobe r8152 || true
modprobe br_netfilter || true

MARKER_FILE="/var/lib/.resize_done"
if [ ! -f "$MARKER_FILE" ]; then
    echo "Resizing partition and filesystem..."

    parted /dev/sda resizepart 2 100% --script
    resize2fs /dev/sda2

    touch "$MARKER_FILE"
fi
